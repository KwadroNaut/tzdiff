#!/bin/sh

format='%F %R %Z'
max=10

__check_match () {
	if [ `echo ${1} | wc -w` -eq 1 ]
	then
		return 0
	fi
	ls -dF ${1}
	exit 1
}

__set_zoneinfo () {

	case "${1}" in
	*\**)
		__check_match "${1}*"
		zi=`echo ${1}*`
		;;

	*)	zi=${1}
		;;
	esac

	while [ ! -f ${zi} ]
	do
		if [ -d ${zi} ]; then
			ls -dF ${zi}/*
			exit 1
		fi

		__check_match "${zi}*"
		zi=`echo ${zi}*`
		if [ ! -e ${zi} ]; then
			__check_match "*/${zi}"
			zi=`echo */${zi}`
			if [ ! -e ${zi} ]; then
				__check_match "*/${zi}"
				zi=`echo */${zi}`
				if [ ! -e ${zi} ]; then
					ls -F
					exit 2
				fi
			fi
		fi
	done
}

__usage () {
	echo "Usage: ${0##*/} zoneinfo [ count ]" 1>&2
	exit 2
}

cd /usr/share/zoneinfo || exit

if [ $# -eq 0 ]; then
	ls -F
	exit
elif [ $# -eq 1 ]; then
	case ${1} in
	-*) __usage ;;
	esac
elif [ $# -ge 3 ]; then
	__usage
elif [ ${2} -gt  0 ]; then
	max=${2}
fi

__set_zoneinfo "${1}"

ut=$(( (`date +%s`/3600)*3600 ))

echo ${zi}

if type jot >/dev/null 2>&1
then
	# this system has 'jot', it may be *BSD or macOS
	for i in `jot ${max} 0`
	do
		remote=`TZ=${zi} date -r ${ut} +"${format}"`
		local=`date -r ${ut} +"${format}"`
		echo ${remote}'     '${local}
		ut=$((ut + 3600))
	done
else
	# this system does not have 'jot', it may be Linux box.
	for i in `seq 1 ${max}`
	do
		remote=`TZ=${zi} date --date=@${ut} +"${format}"`
		local=`date --date=@${ut} +"${format}"`
		echo ${remote}'     '${local}
		ut=$((ut + 3600))
	done
fi
